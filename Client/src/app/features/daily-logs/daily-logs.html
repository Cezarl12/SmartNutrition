<div class="bg-white/90 flex  flex-col w-8/10 h-auto m-auto mt-40 px-20 py-10 rounded-2xl shadow-xl">
    <div class="flex flex-row">
        <div class="flex flex-row items-center">
            <i (click)="prevPage()" class="fa-solid fa-angle-left text-4xl transition-transform duration-300 hover:scale-110 hover:text-blue-300 cursor-pointer"></i>

                <div class="relative group">
                    <button (click)="picker.open()" 
                        class="w-full rounded-full h-10 text-xl items-center font-medium shadow-2xs p-6 flex  justify-center text-gray-700 cursor-pointer border-2 border-gray-300 
                        hover:ring-1 hover:outline-none hover:border-blue-200 hover:ring-green-300
                        disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:ring-0">
                    
                        <i class="fa-regular fa-calendar text-xl"></i>

                            <span>
                                @if (range.value.start && range.value.end) {
                                    {{ range.value.start | date:'d MMM' }} - {{ range.value.end | date:'d MMM yyyy' }}
                                } @else {
                                    Selectează Perioada
                                }
                            </span>
                     </button>

                    <div class="invisible  opacity-0 absolute pointer-events-none -mt-12">
                         <mat-form-field>
                            <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
                                <input matStartDate formControlName="start" placeholder="Start">
                                <input matEndDate formControlName="end" placeholder="End" 
                                    (dateChange)="applyDateFilter()">
                            </mat-date-range-input>
                            <mat-date-range-picker #picker></mat-date-range-picker>
                        </mat-form-field>
                    </div>

        
                    @if (range.value.start) {
                        <div (click)="clearDateFilter()" 
                            class="absolute -top-2 -right-2 w-6 h-6 bg-red-100 text-red-500 rounded-full 
                                    flex items-center justify-center cursor-pointer hover:bg-red-200 shadow-sm text-xs font-bold"
                            title="Șterge filtrul">
                            ✕
                        </div>
                    }
             </div>

            <i (click)=" nextPage()" class="fa-solid fa-angle-right text-4xl transition-transform duration-300 hover:scale-110 hover:text-blue-300 cursor-pointer"></i>
        </div>
        <div class="flex items-center">
            <p class="text-2xl text-gray-700">{{firstDate()|date:'d MMMM'}} - {{lastDate()|date:'d MMMM'}}</p>
        </div>
        <div class=" flex ml-auto items-center">
               <button (click)="generateReport()"  class="w-full rounded-full h-10 bg-linear-to-l from-green-100 via-teal-100 to-cyan-100 text-lg xl:text-xl 
                font-medium shadow-2xs p-6 flex items-center justify-center text-gray-700 cursor-pointer border-2 border-gray-300 
                hover:ring-1 hover:outline-none hover:border-blue-200 hover:ring-green-300
                disabled:cursor-not-allowed disabled:opacity-50 disabled:hover:ring-0">Generate Report</button>
        </div>
    </div>
    <div class="flex flex-row gap-5 h-auto items-start mt-10 rounded-xl">
         @for(log of dailyLogs(); track log){
        <div [routerLink]="['/dailylogs',log.id]" class="h-auto w-1/5 bg-white/50 shadow-xl gap-x-5 text-gray-800 py-3 transition-all duration-500 transform translate-y-5 
        hover:scale-102 hover:shadow-2xl hover:bg-white cursor-pointer rounded-xl">
            <div class="flex flex-row justify-between px-3">
                <div>
                    <p class="text-xl font-medium">{{log.date | date:'d MMMM'}}</p>
                     <p class="text-lg">{{log.date | date:'EEEE'}}</p>
                </div>

                <div class="flex flex-col space-y-2">
                    <i (click)="$event.stopPropagation(); remove(log.id)" 
                        class="self-end fa-solid fa-trash text-gray-800 hover:text-red-400 text-xl cursor-pointer transition-colors duration-200"
                        title="Șterge acest jurnal"></i>
                    <div class="w-15 h-15">
                        <app-pie-chart [data]="getPieChartDataTotal(log)"></app-pie-chart>
                    </div>
                    <p class="text-lg">{{log.totalKcal}} kcal</p>
                </div>
            </div>
        

        @for(meal of log.meals;track meal){
            <div class="bg-white/80 border border-gray-200 h-auto flex flex-col mt-5 shadow-xl p-5 text-gray-800 rounded-xl">
                <h2 class="text-xl font-medium">{{meal.mealName}}</h2>
                <p  class="text-base"><span class="font-medium">{{meal.totalCalories}}</span> kcal</p>
                @for(recipe of meal.recipes;track recipe){
                    <div class="mt-2 group">
                        <img [routerLink]="['/food', recipe.foodId]"  [src]="'foods/' + recipe.imageUrl" alt="" class="h-auto w-30 transition-transform 
                        duration-300 group-hover:scale-105 cursor-pointer ">
                        <p [routerLink]="['/food', recipe.foodId]" class="text-lg   group-hover:underline group-hover:text-blue-300 cursor-pointer">{{recipe.name}}</p>
                        <div>
                            <p class="text-">Cantitate consumată:<span class="font-medium"> {{recipe.quantityConsumedInGrams}} g</span></p>
                        </div>
                    </div>
                }

            </div>
        }
       
        </div>
    }
    </div>
</div>